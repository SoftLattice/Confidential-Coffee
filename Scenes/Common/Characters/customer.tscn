[gd_scene load_steps=16 format=3 uid="uid://dcdjonkjbxh0r"]

[ext_resource type="Script" path="res://Scenes/Common/Characters/customer.gd" id="1_ljmpa"]
[ext_resource type="Texture2D" uid="uid://dxjl86xa2pcep" path="res://Scenes/Common/Characters/Handler/handler.png" id="2_topkw"]
[ext_resource type="Shader" path="res://Scenes/Common/Characters/character_cafe.gdshader" id="3_645i4"]
[ext_resource type="Texture2D" uid="uid://bwmsidq8xl12w" path="res://Scenes/Common/Characters/flag_sheet.png" id="3_xixbp"]
[ext_resource type="Script" path="res://Scripts/StateMachine/Customer/customer_state_machine.gd" id="4_ulwlg"]
[ext_resource type="Script" path="res://Scripts/StateMachine/Customer/walking.gd" id="5_uc7lx"]
[ext_resource type="Script" path="res://Scripts/StateMachine/Customer/idle.gd" id="6_41h4p"]
[ext_resource type="PackedScene" uid="uid://b8xwen6ao2c85" path="res://Scenes/Common/SpeechBubble/speech_bubble.tscn" id="6_42wp8"]
[ext_resource type="Script" path="res://Scripts/StateMachine/Customer/queued.gd" id="7_kuhq5"]
[ext_resource type="Script" path="res://Scripts/StateMachine/Customer/next_up.gd" id="8_6ed6q"]
[ext_resource type="Script" path="res://Scripts/StateMachine/Customer/ordering.gd" id="9_7p6l2"]
[ext_resource type="Script" path="res://Scripts/StateMachine/Customer/exiting.gd" id="13_hcb6v"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_xss8d"]
resource_local_to_scene = true
transparency = 1
shading_mode = 0
albedo_color = Color(0.501961, 0.501961, 0.501961, 1)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_noaim"]
resource_local_to_scene = true
render_priority = 0
shader = ExtResource("3_645i4")
shader_parameter/modulate_color = Color(0.5, 0.5, 0.5, 0.5)
shader_parameter/modulate_strength = 1.0
shader_parameter/albedo_texture = ExtResource("2_topkw")

[sub_resource type="BoxShape3D" id="BoxShape3D_yhs0y"]
size = Vector3(0.718506, 2.19766, 0.293945)

[node name="Customer" type="Node3D" node_paths=PackedStringArray("visual_node", "person_sprite", "flag", "mugshot_viewport", "animation_state_machine", "idle_state", "walking_state", "speech_location", "utter_timer", "queue_state_machine", "next_up") groups=["customer"]]
script = ExtResource("1_ljmpa")
visual_node = NodePath("Visual")
person_sprite = NodePath("Visual/Person")
flag = NodePath("Visual/Flag")
mugshot_viewport = NodePath("Visual/MugshotViewport")
animation_state_machine = NodePath("CustomerAnimationStateMachine")
idle_state = NodePath("CustomerAnimationStateMachine/Idle")
walking_state = NodePath("CustomerAnimationStateMachine/Walking")
speech_bubble_scene = ExtResource("6_42wp8")
speech_location = NodePath("SpeechLocation")
utter_timer = NodePath("UtterTimer")
queue_state_machine = NodePath("CustomerQueueStateMachine")
next_up = NodePath("CustomerQueueStateMachine/NextUp")
velocity = 1.25

[node name="UtterTimer" type="Timer" parent="."]
wait_time = 3.3
one_shot = true
autostart = true

[node name="SpeechLocation" type="Marker3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.194373, 1.92046, 0)

[node name="Visual" type="Node3D" parent="."]

[node name="Flag" type="Sprite3D" parent="Visual"]
transform = Transform3D(0.75, 0, 0, 0, 0.75, 0, 0, 0, 0.75, 0.166984, 1.66058, 0.001)
material_overlay = SubResource("StandardMaterial3D_xss8d")
transparent = false
double_sided = false
texture_filter = 0
texture = ExtResource("3_xixbp")
hframes = 4
vframes = 2

[node name="Person" type="Sprite3D" parent="Visual"]
material_override = SubResource("ShaderMaterial_noaim")
centered = false
offset = Vector2(-64, 0)
pixel_size = 0.0068
shaded = true
texture_filter = 0
texture = ExtResource("2_topkw")

[node name="MugshotLocation" type="Marker3D" parent="Visual/Person"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.77781, 0.632762)

[node name="RemoteTransform3D" type="RemoteTransform3D" parent="Visual/Person/MugshotLocation"]
remote_path = NodePath("../../../MugshotViewport/Camera3D")

[node name="MugshotViewport" type="SubViewport" parent="Visual"]
size = Vector2i(128, 128)
render_target_update_mode = 4

[node name="Camera3D" type="Camera3D" parent="Visual/MugshotViewport"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.77781, 0.632762)
cull_mask = 2

[node name="CustomerAnimationStateMachine" type="Node" parent="." node_paths=PackedStringArray("initial_state")]
script = ExtResource("4_ulwlg")
initial_state = NodePath("Idle")

[node name="Idle" type="Node" parent="CustomerAnimationStateMachine"]
script = ExtResource("6_41h4p")

[node name="Walking" type="Node" parent="CustomerAnimationStateMachine"]
script = ExtResource("5_uc7lx")

[node name="CustomerQueueStateMachine" type="Node" parent="." node_paths=PackedStringArray("initial_state")]
script = ExtResource("4_ulwlg")
initial_state = NodePath("Queued")

[node name="Queued" type="Node" parent="CustomerQueueStateMachine"]
script = ExtResource("7_kuhq5")

[node name="NextUp" type="Node" parent="CustomerQueueStateMachine"]
script = ExtResource("8_6ed6q")

[node name="Ordering" type="Node" parent="CustomerQueueStateMachine"]
script = ExtResource("9_7p6l2")

[node name="Exiting" type="Node" parent="CustomerQueueStateMachine"]
script = ExtResource("13_hcb6v")

[node name="CollisionArea" type="Area3D" parent="."]

[node name="CollisionShape" type="CollisionShape3D" parent="CollisionArea"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.10182, 0)
shape = SubResource("BoxShape3D_yhs0y")

[connection signal="approach_counter" from="." to="CustomerQueueStateMachine/NextUp" method="_on_approach_counter"]
[connection signal="immediate_exit" from="." to="CustomerQueueStateMachine" method="_on_immediate_exit"]
[connection signal="order_completed" from="." to="CustomerQueueStateMachine/Ordering" method="_on_order_completed"]
[connection signal="place_order" from="." to="." method="_on_place_order"]
[connection signal="start_walking" from="." to="CustomerAnimationStateMachine/Idle" method="_on_start_walking"]
[connection signal="stop_walking" from="." to="CustomerAnimationStateMachine/Walking" method="_on_stop_walking"]
[connection signal="timeout" from="UtterTimer" to="." method="_utter_phrase"]
[connection signal="counter_distance_change" from="CustomerQueueStateMachine/NextUp" to="." method="_on_counter_distance_change"]
[connection signal="leaving_queue" from="CustomerQueueStateMachine/NextUp" to="Visual/Flag" method="set_layer_mask" binds= [3]]
[connection signal="leaving_queue" from="CustomerQueueStateMachine/NextUp" to="Visual/Person" method="set_layer_mask" binds= [3]]
[connection signal="start_exit" from="CustomerQueueStateMachine/Exiting" to="." method="_on_start_exit"]
